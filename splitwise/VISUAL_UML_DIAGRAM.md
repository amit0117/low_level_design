# 🎨 Splitwise - Visual UML Diagram

## 📊 Pictorial Class Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           🏢 SPLITWISE SYSTEM ARCHITECTURE                      │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                              🔧 SERVICE LAYER                                 │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                    🎯 SplitWiseService (Singleton + Facade)            │    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐          │    │
│  │  │   UserService   │  │  GroupService   │  │   ThreadLock   │          │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘          │    │
│  │                                                                         │    │
│  │  📋 Methods:                                                           │    │
│  │  • add_user() • add_group() • add_expense_to_group()                  │    │
│  │  • show_user_balance_sheet() • settle_up()                             │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              👥 DOMAIN LAYER                                  │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                            👤 User (Observer)                          │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │    │
│  │  │    id       │  │    name     │  │    email    │  │balance_sheet│    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │    │
│  │                                                                         │    │
│  │  📢 Observer Methods:                                                  │    │
│  │  • expense_update() • transaction_update() • update_group()           │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        │                                        │
│                                        ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        🏠 Group (GroupSubject)                        │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │    │
│  │  │     id      │  │    name     │  │   members   │  │  expenses   │    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │    │
│  │                                                                         │    │
│  │  🧮 Advanced Features:                                                 │    │
│  │  • simplify_expenses() - Heap-based debt minimization                  │    │
│  │  • add_member() • remove_member() • add_expense()                     │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        │                                        │
│                                        ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        💰 Expense (ExpenseSubject)                     │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │    │
│  │  │     id      │  │ description │  │   amount    │  │  paid_by    │    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │    │
│  │  │participants │  │split_strategy│  │created_at   │  │split_values │    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │    │
│  │                                                                         │    │
│  │  📊 Methods: • get_splits() • get_participants() • get_amount()        │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        │                                        │
│                                        ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                    💸 Transaction (TransactionSubject)                  │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │    │
│  │  │     id      │  │ from_user   │  │  to_user    │  │   amount    │    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │    │
│  │  ┌─────────────┐                                                       │    │
│  │  │   status    │                                                       │    │
│  │  └─────────────┘                                                       │    │
│  │                                                                         │    │
│  │  🔄 Status: PENDING → COMPLETED/FAILED                                 │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        │                                        │
│                                        ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        📊 BalanceSheet (Thread-Safe)                    │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │    │
│  │  │   owner     │  │  balances    │  │    lock     │                    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │    │
│  │                                                                         │    │
│  │  🔒 Thread Safety: Lock-based concurrent balance updates                │    │
│  │  📈 Methods: • adjust_balance() • show_balances()                      │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        │                                        │
│                                        ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                            ✂️ Split                                    │    │
│  │  ┌─────────────┐  ┌─────────────┐                                      │    │
│  │  │    user     │  │   amount    │                                      │    │
│  │  └─────────────┘  └─────────────┘                                      │    │
│  │                                                                         │    │
│  │  📋 Methods: • get_user() • get_amount() • set_amount()               │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              ⚙️ STRATEGY LAYER                                │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        🎯 SplitStrategy (Abstract)                      │    │
│  │                                                                         │    │
│  │  📋 Abstract Method:                                                   │    │
│  │  • calculate_splits(total_amount, paid_by, participants, split_values) │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        │                                        │
│                                        ▼                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │    │
│  │  │EqualSplitStrategy│  │PercentSplitStrategy│ │ExactSplitStrategy│        │    │
│  │  │                 │  │                 │  │                 │        │    │
│  │  │ Split equally  │  │ Split by %     │  │ Split by exact │        │    │
│  │  │ among all      │  │ (40%, 30%, 30%)│  │ amounts        │        │    │
│  │  │ participants   │  │                 │  │ (₹1000, ₹500)  │        │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              🔨 BUILDER LAYER                                 │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        🏗️ ExpenseBuilder                              │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │    │
│  │  │     id      │  │ description │  │   amount    │  │  paid_by    │    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘    │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │    │
│  │  │participants │  │split_strategy│  │split_values │                    │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │    │
│  │                                                                         │    │
│  │  🔧 Builder Methods:                                                  │    │
│  │  • set_description() • set_amount() • set_paid_by()                   │    │
│  │  • set_participants() • set_split_strategy() • build()                │    │
│  │                                                                         │    │
│  │  ✅ Validation: Ensures all required fields are set                   │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              👁️ OBSERVER LAYER                               │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        👀 Observer (Abstract)                          │    │
│  │                                                                         │    │
│  │  📋 Abstract Method: • update(data, message)                          │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        ▲                                        │
│                                        │                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │                        📢 Subject (Abstract)                           │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                    │    │
│  │  │ _observers  │  │add_observer │  │remove_observer│                   │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                    │    │
│  │                                                                         │    │
│  │  📋 Abstract Method: • notify_observers(data, message)                 │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
│                                        ▲                                        │
│                                        │                                        │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐        │    │
│  │  │  GroupSubject   │  │ ExpenseSubject  │  │TransactionSubject│        │    │
│  │  │                 │  │                 │  │                 │        │    │
│  │  │ Group events    │  │ Expense events │  │Transaction events│        │    │
│  │  │ notifications   │  │ notifications   │  │ notifications   │        │    │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘        │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
                                        │
                                        ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              📋 ENUM LAYER                                     │
│                                                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────┐    │
│  │  ┌─────────────────┐              ┌─────────────────┐                │    │
│  │  │   SplitType     │              │TransactionStatus│                │    │
│  │  │                 │              │                 │                │    │
│  │  │ • EQUAL         │              │ • PENDING       │                │    │
│  │  │ • EXACT         │              │ • COMPLETED     │                │    │
│  │  │ • PERCENTAGE    │              │ • FAILED       │                │    │
│  │  └─────────────────┘              └─────────────────┘                │    │
│  └─────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────┘
```

## 🔗 Key Relationships (Visual Flow)

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              🔄 DATA FLOW DIAGRAM                              │
└─────────────────────────────────────────────────────────────────────────────────┘

User Request ──┐
               │
               ▼
    ┌─────────────────┐
    │ SplitWiseService│ ◄─── Singleton Pattern
    │   (Facade)      │
    └─────────────────┘
               │
               ▼
    ┌─────────────────┐
    │ UserService     │
    │ GroupService    │
    └─────────────────┘
               │
               ▼
    ┌─────────────────┐
    │ Domain Models   │ ◄─── Observer Pattern
    │ • User           │
    │ • Group          │
    │ • Expense        │
    │ • Transaction    │
    └─────────────────┘
               │
               ▼
    ┌─────────────────┐
    │ Strategy Layer  │ ◄─── Strategy Pattern
    │ • SplitStrategy │
    └─────────────────┘
               │
               ▼
    ┌─────────────────┐
    │ Builder Layer   │ ◄─── Builder Pattern
    │ • ExpenseBuilder│
    └─────────────────┘
               │
               ▼
    ┌─────────────────┐
    │ Observer Layer  │ ◄─── Observer Pattern
    │ • Notifications │
    └─────────────────┘
               │
               ▼
    Response ──────────┘
```

## 🎯 Design Pattern Summary

| Pattern          | Implementation                | Purpose                                    |
| ---------------- | ----------------------------- | ------------------------------------------ |
| 🔒 **Singleton** | SplitWiseService              | Single instance across application         |
| 🏛️ **Facade**    | SplitWiseService              | Simplified interface to complex subsystems |
| ⚙️ **Strategy**  | SplitStrategy implementations | Different splitting algorithms             |
| 👁️ **Observer**  | User implements Observer      | Real-time event notifications              |
| 🔨 **Builder**   | ExpenseBuilder                | Complex object construction                |

## 🚀 Advanced Features Highlighted

- **🧮 Debt Simplification**: Heap-based algorithm in Group.simplify_expenses()
- **🔒 Thread Safety**: Lock-based concurrent operations in BalanceSheet
- **📢 Real-time Notifications**: Observer pattern for instant updates
- **✅ Input Validation**: Builder pattern with comprehensive validation
- **🎯 Clean Architecture**: Layered design with separation of concerns
